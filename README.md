# Домашнее задание к занятию «Работа в терминале. Лекция 2»

### Цель задания

В результате выполнения задания вы:

* познакомитесь с возможностями некоторых команд (grep, wc), чтобы в дальнейшем обращать внимание на схожие особенности команд;
* попрактикуетесь с перенаправлением потоков ввода, вывода, ошибок, что поможет грамотно использовать функционал в скриптах;
* поработаете с файловой системой /proc как примером размещения информации о процессах.


### Инструкция к заданию

1. Создайте .md-файл для ответов на вопросы задания в своём репозитории, после выполнения прикрепите ссылку на него в личном кабинете.
2. Любые вопросы по решению задач задавайте в чате учебной группы.

------

### Дополнительные материалы для выполнения задания

1. [Статья с примерами перенаправлений в Bash и работы с файловыми дескрипторами](https://wiki.bash-hackers.org/howto/redirection_tutorial).


------

## Задание

Ответьте на вопросы:

1. Какого типа команда `cd`? Попробуйте объяснить, почему она именно такого типа: опишите ход своих мыслей и поясните, если считаете, что она могла бы быть другого типа.
```
cd - встроенная команда bash
проверить можно командой 
type -a cd
Логчно команду для смены каталога в командной оболочке сделать встроенной.
В теории можно сделать и внешней, но придется как то передавать значение текущего каталога, зачем?
```
3. Какая альтернатива без pipe для команды `grep <some_string> <some_file> | wc -l`?   
```
grep <some_string> <some_file> -c
```

	<details>
	<summary>Подсказка.</summary>

	`man grep` поможет в ответе на этот вопрос. 

	</details>
	
	Изучите [документ](http://www.smallo.ruhr.de/award.html) о других подобных некорректных вариантах использования pipe.


3. Какой процесс с PID `1` является родителем для всех процессов в вашей виртуальной машине Ubuntu 20.04?
```
/sbin/init
в линкс обычно везде так
```
5. Как будет выглядеть команда, которая перенаправит вывод stderr `ls` на другую сессию терминала?
```
например ls %%% 2> /dev/pts/1
```


7. Получится ли одновременно передать команде файл на stdin и вывести её stdout в другой файл? Приведите работающий пример.
```
cat < rbt.log > new.log
```

9. Получится ли, находясь в графическом режиме, вывести данные из PTY в какой-либо из эмуляторов TTY? Сможете ли вы наблюдать выводимые данные?
```
Можно для этого по cntr alt f1 переклчится в консоль tty1
залогиниться иначе будет отказано в доступе
переключится обратно по alt f7
и к примеру cat rbt.log > /dev/tty1
переключившись на tty1 можно будет наблюдать вывод лога
```


11. Выполните команду `bash 5>&1`. К чему она приведёт? Что будет, если вы выполните `echo netology > /proc/$$/fd/5`? Почему так происходит?
```
запустится дочерний процесс bash c файловым дескриптором 5 (этот дескриптор стандартно не используется) и перенаправлением вывода в stdout
есл пытаемся что то записать в /proc/$$/fd/5 то конструкция 5>&1 перенаправит данные в стандартный вывод
```
14. Получится ли в качестве входного потока для pipe использовать только stderr команды, не потеряв отображение stdout на pty?  
	Напоминаем: по умолчанию через pipe передаётся только stdout команды слева от `|` на stdin команды справа.
Это можно сделать, поменяв стандартные потоки местами через промежуточный новый дескриптор, который вы научились создавать в предыдущем вопросе.
```
для примера использую команду ls
ls % rbt.log 3>&2 2>&1 1>&3 | less
где % не существует а файл rbt.log в наличии
в результате в less получаем ошибку а по выходу в консоль имя файла rbt.log
```


1. Что выведет команда `cat /proc/$$/environ`? Как ещё можно получить аналогичный по содержанию вывод?
```
переменные окружения процесса $$ при запуске если в терминале то процесса bash
аналог env
printenv
```

3. Используя `man`, опишите, что доступно по адресам `/proc/<PID>/cmdline`, `/proc/<PID>/exe`.
```
содержит полную командную строку процесса пока процесс не zombi
содержит символическую ссылку на актуальный путь к команде запущеного процесса
```
4. Узнайте, какую наиболее старшую версию набора инструкций SSE поддерживает ваш процессор с помощью `/proc/cpuinfo`.
```
sse4_2
```
5. При открытии нового окна терминала и `vagrant ssh` создаётся новая сессия и выделяется pty.  
	Это можно подтвердить командой `tty`, которая упоминалась в лекции 3.2.  
	
	Однако:

    ```bash
	vagrant@netology1:~$ ssh localhost 'tty'
	not a tty
    ```

	Почитайте, почему так происходит и как изменить поведение.
```

Все работает без проблем изначально:

yaha@myaspire:~$ cd projects/ubuntu
yaha@myaspire:~/projects/ubuntu$ vagrant ssh
Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.4.0-135-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed 15 Mar 2023 04:10:40 PM UTC

  System load:  0.24               Processes:             147
  Usage of /:   12.3% of 30.34GB   Users logged in:       0
  Memory usage: 5%                 IPv4 address for eth0: 10.0.2.15
  Swap usage:   0%


This system is built by the Bento project by Chef Software
More information can be found at https://github.com/chef/bento
Last login: Wed Mar 15 16:05:24 2023 from 10.0.2.2
vagrant@vagrant:~$ ssh localhost 'tty'
vagrant@localhost's password: 
```


	
1. Бывает, что есть необходимость переместить запущенный процесс из одной сессии в другую. Попробуйте сделать это, воспользовавшись `reptyr`. Например, так можно перенести в `screen` процесс, который вы запустили по ошибке в обычной SSH-сессии.
```
утилита полезная но работает не везде, необходимо править echo 0 > /proc/sys/kernel/yama/ptrace_scope
```
1. `sudo echo string > /root/new_file` не даст выполнить перенаправление под обычным пользователем, так как перенаправлением занимается процесс shell, который запущен без `sudo` под вашим пользователем. Для решения этой проблемы можно использовать конструкцию `echo string | sudo tee /root/new_file`. Узнайте, что делает команда `tee` и почему в отличие от `sudo echo` команда с `sudo tee` будет работать.
```
tee читает стандартный ввод и пишет в стандартный выход и файл.
Второй вариент с sudo tee работать будет т.к передаем данные от обычного пользователя через pipe в команду tee работающую с правами суперпользователя
```
----

### Правила приёма домашнего задания

В личном кабинете отправлена ссылка на .md файл в вашем репозитории.


### Критерии оценки

Зачёт:

* выполнены все задания;
* ответы даны в развёрнутой форме;
* приложены соответствующие скриншоты и файлы проекта;
* в выполненных заданиях нет противоречий и нарушения логики.

На доработку:

* задание выполнено частично или не выполнено вообще;
* в логике выполнения заданий есть противоречия и существенные недостатки.
